default_config:

homeassistant:
  packages: !include_dir_named packages

frontend:
  themes: !include_dir_merge_named themes

automation: !include automations.yaml
script: !include scripts.yaml
scene: !include scenes.yaml

sensor:
  - platform: time_date
    display_options:
      - time
      - date

template:
  - sensor:
      - name: Kitchen Date Nice
        state: "{{ now().strftime('%a %d %b') }}"

      - name: Kitchen Weather Line
        state: >
          {% set cond = states('weather.met_office_shawlands') %}
          {% set t = state_attr('weather.met_office_shawlands','temperature') %}
          {{ (cond | title) ~ '  ' ~ ((t | round(0)) if t is number else t) ~ 'Â°C' }}

      - name: Kitchen Temp
        state: "{{ state_attr('weather.met_office_shawlands','temperature') | round(0) }}"
        unit_of_measurement: "Â°C"

      - name: Shop Wed Full
        state: "{{ states('input_text.shop_wed') }}"

      - name: Shop Sun Full
        state: "{{ states('input_text.shop_sun') }}"

  - sensor:
      - name: Meal Planner Week Cost
        unique_id: meal_planner_week_cost
        unit_of_measurement: "Â£"
        state: "{{ state_attr('sensor.meal_planner_week_raw', 'week_cost') | default(0) }}"

      - name: Meal Planner Today Cost
        unique_id: meal_planner_today_cost
        unit_of_measurement: "Â£"
        state: "{{ state_attr('sensor.meal_planner_week_raw', 'today_cost') | default(0) }}"

      - name: Meal Planner Week Start
        unique_id: meal_planner_week_start
        state: "{{ state_attr('sensor.meal_planner_week_raw', 'week_start') | default('') }}"

      - name: Meal Planner Last Updated
        unique_id: meal_planner_last_updated
        state: "{{ state_attr('sensor.meal_planner_week_raw', 'last_updated') | default('') }}"

      - name: Meal Planner Today Totals
        unique_id: meal_planner_today_totals
        state: >
          {{ (state_attr('sensor.meal_planner_week_raw', 'today_totals') | default([])) | length }}
        attributes:
          totals: "{{ state_attr('sensor.meal_planner_week_raw', 'today_totals') | default([]) }}"

      - name: Meal Planner Week Totals
        unique_id: meal_planner_week_totals
        state: >
          {{ (state_attr('sensor.meal_planner_week_raw', 'week_totals') | default([])) | length }}
        attributes:
          totals: "{{ state_attr('sensor.meal_planner_week_raw', 'week_totals') | default([]) }}"

      - name: Meal Planner Wed Shopping Count
        unique_id: meal_planner_wed_shopping_count
        state: "{{ (state_attr('sensor.meal_planner_week_raw', 'wed_shopping') | default([])) | length }}"

      - name: Meal Planner Sun Shopping Count
        unique_id: meal_planner_sun_shopping_count
        state: "{{ (state_attr('sensor.meal_planner_week_raw', 'sun_shopping') | default([])) | length }}"

      - name: Meal Planner Wed Shopping Text
        unique_id: meal_planner_wed_shopping_text
        state: "ok"
        attributes:
          lines: >
            {% set items = state_attr('sensor.meal_planner_week_raw','wed_shopping') | default([]) %}
            {{ items | map(attribute='ingredient') | list }}
          text: >
            {% set items = state_attr('sensor.meal_planner_week_raw','wed_shopping') | default([]) %}
            {% for i in items %}
            - {{ i.ingredient }}: {{ i.quantity }} {{ i.unit }} (Â£{{ i.cost }})
            {% endfor %}

      - name: Meal Planner Sun Shopping Text
        unique_id: meal_planner_sun_shopping_text
        state: "ok"
        attributes:
          lines: >
            {% set items = state_attr('sensor.meal_planner_week_raw','sun_shopping') | default([]) %}
            {{ items | map(attribute='ingredient') | list }}
          text: >
            {% set items = state_attr('sensor.meal_planner_week_raw','sun_shopping') | default([]) %}
            {% for i in items %}
            - {{ i.ingredient }}: {{ i.quantity }} {{ i.unit }} (Â£{{ i.cost }})
            {% endfor %}

lovelace:
  dashboards:
    meal_planner_test:
      mode: yaml
      title: Meal Planner Test
      icon: mdi:food
      show_in_sidebar: true
      filename: dashboards/meal-planner-test.yaml
    year-planner:
      mode: yaml
      title: Year Planner
      icon: mdi:calendar
      show_in_sidebar: true
      filename: dashboards/year-planner.yaml

    kitchen-calendar:
      mode: yaml
      title: Kitchen Calendar
      icon: mdi:home
      show_in_sidebar: true
      filename: dashboards/kitchen-calendar.yaml

    brain-dashboard:
      mode: yaml
      title: Brain
      icon: mdi:database-cog
      show_in_sidebar: true
      filename: dashboards/brain.yaml
